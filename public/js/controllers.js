// Generated by CoffeeScript 1.6.2
'use strict';angular.module('gottaGo.controllers', ['ngResource', 'ngCookies']).controller('GGMainCtrl', function($rootScope, $scope, socket, Que, roomNames, $timeout, $cookieStore) {
  $scope.floorsArray = [];
  $scope.que = [];
  $scope.floor = {};
  $scope.notify = {};
  $scope.selectedFloor = $cookieStore.get('GGSelectedFloor') ? $cookieStore.get('GGSelectedFloor') : 2;
  $scope.changeSelectedFloor = function() {
    return $scope.selectedFloor = $scope.selectedFloor === 2 ? 3 : 2;
  };
  $scope.milliseconds = function(stamp) {
    return Date.parse(stamp).getTime();
  };
  $scope.getRoomNames = function(floor, room) {
    return roomNames[floor + room];
  };
  socket.on('init', function(data) {
    $scope.floorsArray = data.floorsArray;
    $rootScope.currentFloorArray = $scope.floorsArray[$scope.floorArrayIndex($scope.selectedFloor)];
    return $scope.que = data.queObj;
  });
  socket.on('event', function(data) {
    var floor, floorIndex, room, roomIndex, _i, _j, _len, _len1, _ref;

    _ref = $scope.floorsArray;
    for (floorIndex = _i = 0, _len = _ref.length; _i < _len; floorIndex = ++_i) {
      floor = _ref[floorIndex];
      for (roomIndex = _j = 0, _len1 = floor.length; _j < _len1; roomIndex = ++_j) {
        room = floor[roomIndex];
        if (room.room === data.room && room.floor === data.floor) {
          $scope.floorsArray[floorIndex].splice(roomIndex, 1, data);
          $rootScope.currentFloorArray = $scope.floorsArray[$scope.floorArrayIndex($scope.selectedFloor)];
          return;
        }
      }
    }
  });
  $scope.$watch('selectedFloor', function(newValue) {
    $cookieStore.put('GGSelectedFloor', newValue);
    return $rootScope.currentFloorArray = $scope.floorsArray[$scope.floorArrayIndex(newValue)];
  });
  socket.on('que', function(data) {
    $scope.que[data.floor] = data.count;
    if (data.count === 0) {
      return $scope.notify[data.floor] = '';
    }
  });
  socket.on('analytics', function(data) {
    return $scope.stats = data.stats;
  });
  $scope.addToQue = function(floor, contact) {
    return Que.post(floor, {
      contact: contact
    }).success(function(response) {
      return $scope.notify[floor] = 'qued';
    });
  };
  return $scope.floorArrayIndex = function(selectedFloor) {
    if (selectedFloor === 2) {
      return 0;
    } else {
      return 1;
    }
  };
});
